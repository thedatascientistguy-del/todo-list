version: '3.8'

services:
  web:
    container_name: jenkins-web
    image: python:3.11
    ports:
      - "9000:8000"           # Different port for Jenkins
    volumes:
      - ./app:/app            # Mount the code from your repo
    working_dir: /app
    command: uvicorn main:app --host 0.0.0.0 --port 8000
    environment:
      - MONGODB_URL=mongodb://mongodb:27017/
    depends_on:
      - mongodb
    networks:
      - jenkins_network
    restart: always

  mongodb:
    container_name: jenkins-mongodb
    image: mongo:latest
    ports:
      - "27018:27017"        # Different port for Jenkins
    volumes:
      - jenkins_mongodb_data:/data/db
    networks:
      - jenkins_network
    restart: always

networks:
  jenkins_network:
    driver: bridge

volumes:
  jenkins_mongodb_data:
